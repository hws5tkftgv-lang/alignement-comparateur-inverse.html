<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Alignement">

<title>Alignement – Comparateur inversé (mils)</title>

<style>
:root{
  --bg:#0b1436;
  --card:#121c4a;
  --text:#eaf1ff;
  --muted:rgba(234,241,255,.75);
  --ok:#4caf50;
  --bad:#ff5252;
  --accent:#00a2ff;
}
*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,system-ui,sans-serif;
}

/* ===== HEADER ===== */
.header{
  position:sticky;
  top:0;
  z-index:20;
  padding:12px;
  text-align:center;
  font-weight:900;
  background:linear-gradient(to bottom,rgba(11,20,54,.98),rgba(11,20,54,.88));
  border-bottom:1px solid rgba(255,255,255,.08);
}
.header button{
  position:absolute;
  right:10px;
  top:8px;
  background:none;
  border:none;
  color:var(--text);
  font-size:20px;
}

/* ===== LAYOUT ===== */
.wrap{ padding:12px; max-width:1000px; margin:auto; }
.grid{
  display:grid;
  gap:12px;
}
@media(min-width:900px){
  .grid{ grid-template-columns:1fr 1fr; }
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:12px;
  border:1px solid rgba(255,255,255,.08);
}

h2{ margin:0 0 8px; font-size:15px; }

.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
}
.badge.ok{ background:rgba(76,175,80,.18); color:#c8f7cb; }
.badge.bad{ background:rgba(255,82,82,.18); color:#ffd0d0; }

/* ===== STEP ===== */
.stepHead{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.stepDesc{
  font-size:13px;
  color:var(--muted);
  margin:6px 0 10px;
}
.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}
@media(max-width:420px){
  .row{ grid-template-columns:1fr; }
}
label{
  font-size:12px;
  color:var(--muted);
}
input{
  width:100%;
  padding:10px;
  font-size:16px;
  border-radius:12px;
  border:none;
}
button{
  padding:12px;
  border:none;
  border-radius:12px;
  font-size:16px;
  font-weight:900;
  background:var(--accent);
  color:#fff;
}
button.secondary{ background:rgba(255,255,255,.15); }

.nav{
  display:flex;
  gap:10px;
  margin-top:10px;
}

/* ===== CANVAS ===== */
.canvasCard{
  background:#000;
  border-radius:14px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.10);
}
.canvasTitle{
  padding:8px 12px;
  font-size:13px;
  background:rgba(0,0,0,.35);
}
canvas{
  width:100%;
  height:260px;
  display:block;
}

/* ===== KPI ===== */
.kpi{
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  background:rgba(0,0,0,.18);
  font-family:ui-monospace,monospace;
  font-size:12px;
  white-space:pre-line;
}

/* ===== MODAL (SAFE iOS) ===== */
.hidden{ display:none; }
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:12px;
  z-index:9999;
}
.modalBox{
  width:min(92vw,560px);
  background:var(--card);
  border-radius:16px;
  padding:14px;
  border:1px solid rgba(255,255,255,.12);
}
.modalBox h3{ margin:0 0 10px; }
.modalBox select, .modalBox button{
  width:100%;
  margin-top:6px;
}
.modalText{
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  background:rgba(0,0,0,.18);
  font-size:13px;
  white-space:pre-line;
}
</style>
</head>

<body>

<div class="header">
  Alignement – Comparateur inversé (mils)
  <button onclick="openInfo()">ℹ️</button>
</div>

<div class="wrap">
<div class="grid">

<!-- ===== ÉTAPES ===== -->
<div class="card">
<h2>Étapes pédagogiques</h2>

<div class="stepHead">
  <div id="stepTitle">—</div>
  <div id="stepBadge" class="badge">—</div>
</div>

<div id="stepDesc" class="stepDesc">—</div>
<div id="stepBody"></div>

<div class="nav">
  <button class="secondary" onclick="prevStep()">◀︎</button>
  <button onclick="nextStep()">Suivant ▶︎</button>
</div>

<div class="kpi" id="kpi"></div>
</div>

<!-- ===== DESSINS ===== -->
<div class="card">
<h2>Dessins</h2>

<div class="canvasCard">
  <div class="canvasTitle">Vue de dessus (horizontal)</div>
  <canvas id="top"></canvas>
</div>

<div class="canvasCard" style="margin-top:12px;">
  <div class="canvasTitle">Vue de profil (vertical)</div>
  <canvas id="side"></canvas>
</div>

</div>

</div>
</div>

<!-- ===== MODAL ===== -->
<div id="infoModal" class="modal hidden">
  <div class="modalBox">
    <h3>Aide pédagogique</h3>
    <select id="infoSel">
      <option value="ordre">Ordre logique</option>
      <option value="runout">Voilage</option>
      <option value="softfoot">Soft foot</option>
      <option value="ang">Angularité</option>
      <option value="par">Parallélisme</option>
    </select>
    <div id="infoTxt" class="modalText"></div>
    <button class="secondary" onclick="closeInfo()">Fermer</button>
  </div>
</div>

<script>
/* ===================== DONNÉES ===================== */
const data = {
  runout:1.2, runoutTol:2,
  sf:{FL:2,FR:1,RL:0.5,RR:3.5}, sfTol:3,
  angV:0, angVTol:1,
  parV:0, parVTol:1,
  angH:0, angHTol:1,
  parH:0, parHTol:1
};

/* ===================== STEPS ===================== */
let step=0;
const STEPS=[
{t:"1) Voilage",d:"Toujours corriger avant toute chose.",
 r:()=>`
 <div class=row>
 <div><label>Voilage</label><input id=runout value="${data.runout}"></div>
 <div><label>Tolérance</label><input id=runoutTol value="${data.runoutTol}"></div>
 </div>`},
{t:"2) Soft foot",d:"Les 4 pattes doivent toucher.",
 r:()=>`
 <div class=row>
 <div><label>FL</label><input id=sfFL value="${data.sf.FL}"></div>
 <div><label>FR</label><input id=sfFR value="${data.sf.FR}"></div>
 </div>
 <div class=row>
 <div><label>RL</label><input id=sfRL value="${data.sf.RL}"></div>
 <div><label>RR</label><input id=sfRR value="${data.sf.RR}"></div>
 </div>
 <div class=row>
 <div><label>Tolérance</label><input id=sfTol value="${data.sfTol}"></div>
 </div>`},
{t:"3) Angularité verticale",d:"Inclinaison avant / arrière.", r:()=>`
 <div class=row>
 <div><label>Valeur</label><input id=angV value="${data.angV}"></div>
 <div><label>Tolérance</label><input id=angVTol value="${data.angVTol}"></div>
 </div>`},
{t:"4) Parallélisme vertical",d:"Décalage global haut / bas.", r:()=>`
 <div class=row>
 <div><label>Valeur</label><input id=parV value="${data.parV}"></div>
 <div><label>Tolérance</label><input id=parVTol value="${data.parVTol}"></div>
 </div>`},
{t:"5) Angularité horizontale",d:"Inclinaison gauche / droite.", r:()=>`
 <div class=row>
 <div><label>Valeur</label><input id=angH value="${data.angH}"></div>
 <div><label>Tolérance</label><input id=angHTol value="${data.angHTol}"></div>
 </div>`},
{t:"6) Parallélisme horizontal",d:"Décalage global gauche / droite.", r:()=>`
 <div class=row>
 <div><label>Valeur</label><input id=parH value="${data.parH}"></div>
 <div><label>Tolérance</label><input id=parHTol value="${data.parHTol}"></div>
 </div>`}
];

/* ===================== UI ===================== */
function render(){
 const s=STEPS[step];
 stepTitle.textContent=s.t;
 stepDesc.textContent=s.d;
 stepBody.innerHTML=s.r();
 document.getElementById("stepBadge").className=
   Math.abs(readVal())<=readTol()?"badge ok":"badge bad";
 document.getElementById("stepBadge").textContent=
   Math.abs(readVal())<=readTol()?"OK":"À corriger";
 draw();
}

function readVal(){
 const ids=["runout","sfFL","angV","parV","angH","parH"];
 const el=document.getElementById(ids[step]);
 return el?parseFloat(el.value)||0:0;
}
function readTol(){
 const ids=["runoutTol","sfTol","angVTol","parVTol","angHTol","parHTol"];
 const el=document.getElementById(ids[step]);
 return el?parseFloat(el.value)||0:0;
}
function nextStep(){ if(step<5) step++; render(); }
function prevStep(){ if(step>0) step--; render(); }

/* ===================== CANVAS (simple & stable) ===================== */
function draw(){
 drawView("top");
 drawView("side");
}
function drawView(id){
 const c=document.getElementById(id);
 const ctx=c.getContext("2d");
 const dpr=window.devicePixelRatio||1;
 c.width=c.clientWidth*dpr;
 c.height=c.clientHeight*dpr;
 ctx.setTransform(dpr,0,0,dpr,0,0);
 ctx.fillStyle="#000";
 ctx.fillRect(0,0,c.width,c.height);
 ctx.fillStyle="#00a2ff";
 ctx.fillRect(40,c.height/2-20,120,40);
 ctx.fillStyle="#ff9800";
 ctx.fillRect(220,c.height/2-20,120,40);
 ctx.strokeStyle="#fff";
 ctx.beginPath();
 ctx.moveTo(160,c.height/2);
 ctx.lineTo(220,c.height/2);
 ctx.stroke();
}

/* ===================== MODAL ===================== */
function openInfo(){
 document.getElementById("infoModal").classList.remove("hidden");
 updateInfo();
}
function closeInfo(){
 document.getElementById("infoModal").classList.add("hidden");
}
const INFO={
 ordre:"Ordre obligatoire :\n1 Voilage\n2 Soft foot\n3 Angularité\n4 Parallélisme",
 runout:"Voilage : faux-rond.\nToujours corriger avant.",
 softfoot:"Soft foot : une patte flotte.\nAjouter ~80% en cales.",
 ang:"Angularité : inclinaison.\nToujours avant parallèle.",
 par:"Parallélisme : décalage global."
};
function updateInfo(){
 infoTxt.textContent=INFO[infoSel.value];
}
infoSel.onchange=updateInfo;

/* INIT */
render();
</script>
</body>
</html>