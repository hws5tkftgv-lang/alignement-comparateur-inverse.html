<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Alignement – Comparateur inversé (débutant)</title>

<style>
:root{
  --bg:#0b1436;
  --card:#121c4a;
  --text:#eaf1ff;
  --muted:#9fb0ff;
  --ok:#4caf50;
  --bad:#ff5252;
  --warn:#ffb300;
  --accent:#00a2ff;
}

*{ box-sizing:border-box; }
html,body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,system-ui,sans-serif;
}

header{
  text-align:center;
  padding:14px;
  font-size:18px;
  font-weight:800;
}

.wrap{
  max-width:820px;
  margin:auto;
  padding:12px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}

.step{
  border:1px solid rgba(255,255,255,.1);
  border-radius:12px;
  padding:12px;
  margin-top:10px;
}

.step h3{
  margin:0 0 6px;
  font-size:15px;
}

.step p{
  margin:0 0 8px;
  font-size:13px;
  color:var(--muted);
}

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

label{
  font-size:12px;
  color:var(--muted);
}

input{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:none;
  font-size:16px;
}

.badge{
  display:inline-block;
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  font-weight:700;
}

.ok{ background:rgba(76,175,80,.2); color:#bff3c1; }
.bad{ background:rgba(255,82,82,.2); color:#ffc2c2; }

.warning{
  margin-top:10px;
  padding:10px;
  border-radius:10px;
  background:rgba(255,179,0,.15);
  color:#ffe6b0;
  font-size:13px;
}

canvas{
  width:100%;
  height:220px;
  background:#000;
  border-radius:12px;
  margin-top:10px;
}
</style>
</head>

<body>

<header>Alignement – méthode comparateur inversé</header>

<div class="wrap">

<div class="card">
<h2>Étapes d’alignement (ordre obligatoire)</h2>

<!-- STEP 1 -->
<div class="step">
<h3>1️⃣ Voilage (runout)</h3>
<p>Vérifier que l’arbre ou l’accouplement n’est pas déformé.</p>
<div class="row">
<div>
<label>Voilage mesuré (mils)</label>
<input id="runout" type="number" value="0.5">
</div>
<div>
<label>Tolérance (mils)</label>
<input id="runoutTol" type="number" value="2">
</div>
</div>
<span id="b1" class="badge">—</span>
</div>

<!-- STEP 2 -->
<div class="step">
<h3>2️⃣ Pied boiteux (4 pattes)</h3>
<p>Chaque patte doit toucher la base sans contrainte.</p>
<div class="row">
<input id="sfFL" type="number" value="0.5" placeholder="AV-G">
<input id="sfFR" type="number" value="0.2" placeholder="AV-D">
</div>
<div class="row">
<input id="sfRL" type="number" value="0.3" placeholder="AR-G">
<input id="sfRR" type="number" value="1.8" placeholder="AR-D">
</div>
<label>Tolérance pied boiteux (mils)</label>
<input id="sfTol" type="number" value="2">
<span id="b2" class="badge">—</span>
</div>

<!-- STEP 3 -->
<div class="step">
<h3>3️⃣ Parallèle vertical</h3>
<p>Décalage vertical égal entre les deux arbres.</p>
<div class="row">
<input id="parV" type="number" value="0">
<input id="parVTol" type="number" value="1">
</div>
<span id="b3" class="badge">—</span>
</div>

<!-- STEP 4 -->
<div class="step">
<h3>4️⃣ Angulaire verticale</h3>
<p>Inclinaison haut / bas entre moteur et machine.</p>
<div class="row">
<input id="angV" type="number" value="0">
<input id="angVTol" type="number" value="1">
</div>
<span id="b4" class="badge">—</span>
</div>

<!-- STEP 5 -->
<div class="step">
<h3>5️⃣ Angulaire horizontale</h3>
<p>Inclinaison gauche / droite.</p>
<div class="row">
<input id="angH" type="number" value="0">
<input id="angHTol" type="number" value="1">
</div>
<span id="b5" class="badge">—</span>
</div>

<!-- STEP 6 -->
<div class="step">
<h3>6️⃣ Parallèle horizontal</h3>
<p>Décalage latéral uniforme.</p>
<div class="row">
<input id="parH" type="number" value="0">
<input id="parHTol" type="number" value="1">
</div>
<span id="b6" class="badge">—</span>
</div>

<div id="orderWarning" class="warning" style="display:none"></div>

<h3>Vue de dessus (horizontal)</h3>
<canvas id="topView"></canvas>

<h3>Vue de profil (vertical)</h3>
<canvas id="sideView"></canvas>

</div>
</div>

<script>
const $ = id => document.getElementById(id);

function worstSoftFoot(){
  return Math.max(
    Math.abs(+sfFL.value),
    Math.abs(+sfFR.value),
    Math.abs(+sfRL.value),
    Math.abs(+sfRR.value)
  );
}

function stepOk(step){
  switch(step){
    case 1: return Math.abs(runout.value)<=runoutTol.value;
    case 2: return worstSoftFoot()<=sfTol.value;
    case 3: return Math.abs(parV.value)<=parVTol.value;
    case 4: return Math.abs(angV.value)<=angVTol.value;
    case 5: return Math.abs(angH.value)<=angHTol.value;
    case 6: return Math.abs(parH.value)<=parHTol.value;
  }
}

function firstBadStep(){
  for(let i=1;i<=6;i++) if(!stepOk(i)) return i;
  return 0;
}

function badge(id, ok){
  $(id).className = "badge " + (ok?"ok":"bad");
  $(id).textContent = ok?"OK":"À corriger";
}

function render(){
  badge("b1",stepOk(1));
  badge("b2",stepOk(2));
  badge("b3",stepOk(3));
  badge("b4",stepOk(4));
  badge("b5",stepOk(5));
  badge("b6",stepOk(6));

  const bad = firstBadStep();
  const warn = $("orderWarning");

  if(bad){
    warn.style.display="block";
    warn.textContent =
      `⚠️ Étape ${bad} à corriger avant d’interpréter les suivantes.`;
  }else{
    warn.style.display="none";
  }

  drawTopView();
drawSideView();
}

function drawTopView(){
  const c = $("topView");
  const ctx = c.getContext("2d");
  c.width = c.clientWidth;
  c.height = 220;

  ctx.clearRect(0,0,c.width,c.height);

  const y = c.height/2;
  const gain = 15;

  // moteur (mobile)
  const dx = parH.value * gain;
  const ang = angH.value * 0.01;

  ctx.save();
  ctx.translate(120 + dx, y);
  ctx.rotate(ang);

  ctx.fillStyle="#00a2ff";
  ctx.fillRect(-60,-20,120,40);
  ctx.restore();

  // pompe (fixe)
  ctx.fillStyle="#ff9800";
  ctx.fillRect(260,y-20,120,40);

  // arbre
  ctx.strokeStyle="#fff";
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.moveTo(180 + dx,y);
  ctx.lineTo(260,y);
  ctx.stroke();
}
function drawSideView(){
  const c = $("sideView");
  const ctx = c.getContext("2d");
  c.width = c.clientWidth;
  c.height = 220;

  ctx.clearRect(0,0,c.width,c.height);

  const xMotor = 120;
  const xPump  = 260;
  const gain = 15;

  // moteur vertical
  const dy = -parV.value * gain;
  const ang = -angV.value * 0.01;

  ctx.save();
  ctx.translate(xMotor,110 + dy);
  ctx.rotate(ang);

  ctx.fillStyle="#00a2ff";
  ctx.fillRect(-60,-20,120,40);
  ctx.restore();

  // pompe
  ctx.fillStyle="#ff9800";
  ctx.fillRect(xPump-60,90,120,40);

  // arbre
  ctx.strokeStyle="#fff";
  ctx.lineWidth=3;
  ctx.beginPath();
  ctx.moveTo(xMotor+60,110+dy);
  ctx.lineTo(xPump-60,110);
  ctx.stroke();

  // pied boiteux (patte la plus mauvaise)
  const sf = worstSoftFoot();
  if(sf > sfTol.value){
    ctx.fillStyle="#ff5252";
    ctx.fillRect(xMotor-40,130 + sf*gain*0.3,20,8);
  }
}
document.querySelectorAll("input").forEach(i=>{
  i.addEventListener("input",render);
});

render();
</script>

</body>
</html>